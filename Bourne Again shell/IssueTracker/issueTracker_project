#!/bin/bash

usage="ERROR\nUsage: issueTracker_project.sh (add|list|delete|load) <url | projectId> \nERROR"

# if no args specified, show usage
if [ $# -le 0 ]; then
  echo -e $usage
  exit 1
fi

ip="10.141.221.80"
port="8002"
baseDir="$ISSUETRACKER_HOME/bin"
token=`cat $baseDir/authentication`
option=$1


case $option in

  (add)
        url=$2
        curl -H "Content-Type:application/json" -H "token:$token" -X POST -d '{"url": "'"$url"'"}' http://$ip:$port/project -s |  grep -Po 'msg[":]+\K[^"]+'
        exit 1
        ;;
  (list)
   # need Formatted output display
    curl -H "token:$token" http://$ip:$port/project -s | jq -r
        exit 1
    ;;
  (delete)
        curl -s -X DELETE -H "token:$token" http://$ip:$port/project/$2  | grep -Po 'msg[":]+\K[^"]+'
    ;;
  (load)
   ### 需要检查用户是否有这个project，暂时未做检查，需要加上project的详情
        echo $2 > $baseDir/project
        echo -e "successful loaded"
    ;;
  (*)
        echo -e "No option $1"
    echo -e $usage
    exit 1
    ;;

esac
